<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ng∆∞·ªùi C·∫ßm Quy·ªÅn Simulator - Multiplayer</title>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- REMOVED Socket.IO from head -->
</head>
<body>
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <h1 class="start-title">NG∆Ø·ªúI C·∫¶M QUY·ªÄN</h1>
        <p class="start-subtitle">Simulator Ch√≠nh Tr·ªã Chi·∫øn L∆∞·ª£c - Multiplayer</p>
        <button class="start-btn" onclick="showGameModeSelection()">B·∫ÆT ƒê·∫¶U GAME</button>
    </div>

    <!-- Game Mode Selection -->
    <div class="game-mode-selection" id="gameModeSelection" style="display: none;">
        <h2 style="color: #4CAF50; margin-bottom: 30px;">Ch·ªçn Ch·∫ø ƒê·ªô Ch∆°i</h2>
        <button class="mode-btn" onclick="startSinglePlayer()">
            üéØ SINGLE PLAYER
            <span>Ch∆°i m·ªôt m√¨nh, chinh ph·ª•c quy·ªÅn l·ª±c</span>
        </button>
        <button class="mode-btn" onclick="showMultiplayerOptions()">
            üë• MULTIPLAYER  
            <span>Ch∆°i v·ªõi b·∫°n b√®, real-time</span>
        </button>
        <button class="mode-btn" onclick="goBack()">
            ‚Ü©Ô∏è QUAY L·∫†I
            <span>V·ªÅ m√†n h√¨nh ch√≠nh</span>
        </button>
    </div>

    <!-- Multiplayer Options -->
    <div class="multiplayer-options" id="multiplayerOptions" style="display: none;">
        <h3 style="color: #4CAF50; margin-bottom: 30px;">Ch·∫ø ƒê·ªô Multiplayer</h3>
        <button class="mp-mode-btn" onclick="createRoom('competitive')">
            üèÜ COMPETITIVE (2-4 ng∆∞·ªùi)
            <span>M·ªói ng∆∞·ªùi cai tr·ªã 1 qu·ªëc gia ri√™ng bi·ªát, thi ƒëua ƒëi·ªÉm s·ªë</span>
        </button>
        <button class="mp-mode-btn" onclick="createRoom('cooperative')">
            ü§ù COOPERATIVE (2-3 ng∆∞·ªùi) 
            <span>C√πng cai tr·ªã 1 qu·ªëc gia, vote quy·∫øt ƒë·ªãnh t·∫≠p th·ªÉ</span>
        </button>
        <button class="mp-mode-btn" onclick="createRoom('versus')">
            ‚öîÔ∏è VERSUS (2 ng∆∞·ªùi)
            <span>1 ng∆∞·ªùi l√†m Ch√≠nh ph·ªß, 1 ng∆∞·ªùi l√†m Phe ƒë·ªëi l·∫≠p</span>  
        </button>
        <div class="join-room">
            <input type="text" placeholder="Nh·∫≠p Room Code" id="roomCodeInput" maxlength="6">
            <button onclick="joinRoom()">Tham Gia</button>
        </div>
        <button class="mode-btn" onclick="showGameModeSelection()" style="margin-top: 30px; background: #666;">
            ‚Ü©Ô∏è QUAY L·∫†I
        </button>
    </div>

    <!-- Room Waiting Screen -->
    <div class="room-waiting" id="roomWaiting" style="display: none;">
        <!-- Content will be populated by JavaScript -->
    </div>

    <!-- Guide Button -->
    <button class="guide-btn" onclick="openGuide()">H∆Ø·ªöNG D·∫™N</button>

    <!-- Connection Status Indicator -->
    <div class="connection-status" id="connectionStatus" style="display: none;">
        üî¥ ƒêang k·∫øt n·ªëi...
    </div>

    <!-- Multiplayer Status Panel -->
    <div class="mp-status" id="mpStatus" style="display: none;">
        <h4 id="mpModeTitle">üèÜ COMPETITIVE</h4>
        <div class="player-list" id="playerList">
            <!-- Players will be populated here -->
        </div>
        <div class="competitive-scores" id="competitiveScores">
            <!-- Scores will be populated here -->
        </div>
    </div>

    <!-- Voting Panel -->
    <div class="voting-panel" id="votingPanel" style="display: none;">
        <!-- Voting content will be populated by JavaScript -->
    </div>

    <!-- Opposition Panel -->
    <div class="opposition-panel" id="oppositionPanel" style="display: none;">
        <!-- Opposition actions will be populated here -->
    </div>

    <!-- Guide Popup -->
    <div class="guide-popup" id="guidePopup" style="display: none;">
        <div class="guide-content">
            <button class="guide-close" onclick="closeGuide()">‚úï</button>
            <h1>H∆Ø·ªöNG D·∫™N MULTIPLAYER - NG∆Ø·ªúI C·∫¶M QUY·ªÄN SIMULATOR</h1>
            
            <h2>üéÆ C√ÅC CHE ƒê·ªò MULTIPLAYER</h2>
            
            <h3>üèÜ COMPETITIVE MODE (2-4 Players)</h3>
            <ul>
                <li>M·ªói ng∆∞·ªùi cai tr·ªã 1 qu·ªëc gia ri√™ng bi·ªát</li>
                <li>C√πng nh·∫≠n events nh∆∞ng c√≥ th·ªÉ ch·ªçn responses kh√°c nhau</li>
                <li>So s√°nh ƒëi·ªÉm s·ªë v√† endings cu·ªëi game</li>
                <li>Ng∆∞·ªùi th·∫Øng: ƒêi·ªÉm cao nh·∫•t + ending t·ªët nh·∫•t</li>
            </ul>

            <h3>ü§ù COOPERATIVE MODE (2-3 Players)</h3>
            <ul>
                <li>C√πng ƒëi·ªÅu h√†nh 1 qu·ªëc gia</li>
                <li>Vote cho t·∫•t c·∫£ quy·∫øt ƒë·ªãnh (ƒëa s·ªë th·∫Øng)</li>
                <li>Shared consequences - c√πng th·∫Øng c√πng thua</li>
                <li>C·∫ßn team strategy v√† th·∫£o lu·∫≠n</li>
            </ul>

            <h3>‚öîÔ∏è VERSUS MODE (2 Players)</h3>
            <ul>
                <li>Player 1: Ch√≠nh ph·ªß (ƒëi·ªÅu h√†nh qu·ªëc gia)</li>
                <li>Player 2: Phe ƒë·ªëi l·∫≠p (c√≥ th·ªÉ sabotage)</li>
                <li>Opposition c√≥ th·ªÉ trigger c√°c events kh√≥ khƒÉn</li>
                <li>Government c·ªë ·ªïn ƒë·ªãnh, Opposition c·ªë l√†m lo·∫°n</li>
            </ul>

            <h2>üéØ C√ÅCH CH∆†I</h2>
            <ol>
                <li>T·∫°o room ho·∫∑c join b·∫±ng Room Code</li>
                <li>Ch·ªù ƒë·ªß ng∆∞·ªùi ch∆°i (t·ªëi thi·ªÉu 2)</li>
                <li>Host b·∫•m "B·∫Øt ƒê·∫ßu Game"</li>
                <li>Ch∆°i theo ch·∫ø ƒë·ªô ƒë√£ ch·ªçn</li>
                <li>Real-time sync v·ªõi Socket.IO</li>
            </ol>

            <h2>üí° CHI·∫æN THU·∫¨T MULTIPLAYER</h2>
            <ul>
                <li><strong>Competitive:</strong> C√¢n b·∫±ng risk vs reward</li>
                <li><strong>Cooperative:</strong> Communication is key</li>
                <li><strong>Versus:</strong> Psychological warfare</li>
            </ul>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="container" id="gameContainer" style="display: none;">
        <!-- Header -->
        <div class="header">
            <h1>NG∆Ø·ªúI C·∫¶M QUY·ªÄN</h1>
            <div class="subtitle">Quy·∫øt ƒë·ªãnh t∆∞∆°ng lai ƒë·∫•t n∆∞·ªõc</div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel" id="statsPanel">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <!-- Game Info -->
        <div class="game-info">
            <div class="turn-counter">L∆∞·ª£t: <span id="turnCounter">1</span></div>
            <div class="game-score">ƒêi·ªÉm: <span id="gameScore">0</span></div>
        </div>

        <!-- Story Section -->
        <div class="story-section">
            <div class="story-title" id="storyTitle">B·∫Øt ƒë·∫ßu nhi·ªám k·ª≥</div>
            <div class="story-text" id="storyText">Ch√†o m·ª´ng ƒë·∫øn v·ªõi gh·∫ø quy·ªÅn l·ª±c. Nh·ªØng quy·∫øt ƒë·ªãnh c·ªßa b·∫°n s·∫Ω ƒë·ªãnh h√¨nh t∆∞∆°ng lai c·ªßa ƒë·∫•t n∆∞·ªõc.</div>
        </div>

        <!-- Choices -->
        <div class="choices-grid" id="choicesGrid">
            <!-- Choices will be populated by JavaScript -->
        </div>

        <!-- Result Panel -->
        <div class="result-panel" id="resultPanel" style="display: none;">
            <!-- Results will be shown here -->
        </div>

        <!-- Random Event -->
        <div class="random-event" id="randomEvent" style="display: none;">
            <!-- Random events will be shown here -->
        </div>

        <!-- Game End -->
        <div class="game-end" id="gameEnd" style="display: none;">
            <!-- Game end screen -->
        </div>
    </div>

    <!-- Scripts - CRITICAL ORDER FOR TIMING -->
    <!-- 1. Socket.IO CDN FIRST - Must load before our modules -->
    <script>
        // Loading indicator
        console.log('üì° Loading Socket.IO...');
        
        // Test function to verify Socket.IO availability
        window.testSocketIO = function() {
            console.log('Socket.IO test:', typeof io);
            return typeof io !== 'undefined';
        };
    </script>
    
    <script 
        src="https://cdn.socket.io/4.8.1/socket.io.min.js" 
        integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" 
        crossorigin="anonymous"
        onload="console.log('‚úÖ Socket.IO loaded successfully'); window.socketIOLoaded = true;"
        onerror="console.error('‚ùå Failed to load Socket.IO'); window.socketIOLoaded = false;">
    </script>
    
    <!-- 2. Wait a bit and then load our modules -->
    <script>
        // Small delay to ensure Socket.IO is fully initialized
        setTimeout(() => {
            console.log('üéØ Socket.IO availability check:', typeof io);
            
            if (typeof io === 'undefined') {
                console.error('‚ùå Socket.IO still not available, using offline mode');
                window.offlineMode = true;
            } else {
                console.log('‚úÖ Socket.IO ready for use');
                window.offlineMode = false;
            }
            
            // Load our JS modules
            const scripts = [
                'js/config.js',
                'js/gameData.js', 
                'js/gameState.js',
                'js/socketManager.js',
                'js/multiplayerManager.js',
                'js/uiManager.js',
                'js/gameEngine.js',
                'js/main.js'
            ];
            
            // Load scripts sequentially
            loadScriptsSequentially(scripts);
            
        }, 200); // 200ms delay
        
        // Function to load scripts in order
        function loadScriptsSequentially(scripts) {
            let index = 0;
            
            function loadNext() {
                if (index >= scripts.length) {
                    console.log('üöÄ All scripts loaded successfully');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = scripts[index];
                script.onload = () => {
                    console.log(`‚úÖ Loaded: ${scripts[index]}`);
                    index++;
                    loadNext();
                };
                script.onerror = () => {
                    console.error(`‚ùå Failed to load: ${scripts[index]}`);
                    index++;
                    loadNext();
                };
                
                document.head.appendChild(script);
            }
            
            loadNext();
        }
    </script>
</body>
</html>
